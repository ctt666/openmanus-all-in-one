<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentæµç¨‹è°ƒè¯•é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="static/manus-main.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .debug-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .debug-content {
            padding: 20px;
        }

        .debug-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: #fafafa;
        }

        .debug-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.2s ease;
        }

        .debug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        .debug-log {
            background: #f8f9fa;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        .status-warning {
            background: #ffc107;
        }

        .preview-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            height: 500px;
            overflow: hidden;
            background: white;
        }

        .preview-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
        }

        .preview-content {
            height: calc(100% - 50px);
            overflow-y: auto;
            padding: 15px;
        }
    </style>
</head>

<body>
    <div class="debug-container">
        <div class="debug-header">
            <h1>ğŸ” Agentæµç¨‹è°ƒè¯•é¡µé¢</h1>
            <p>è°ƒè¯•å‰ç«¯äº¤äº’é—®é¢˜ï¼šåç«¯æ­£å¸¸å‘é€äº‹ä»¶æµä½†å‰ç«¯æ²¡æœ‰è¾“å‡ºå†…å®¹</p>
        </div>

        <div class="debug-content">
            <!-- è°ƒè¯•æ“ä½œ -->
            <div class="debug-section">
                <h3>ğŸ”§ è°ƒè¯•æ“ä½œ</h3>
                <div>
                    <button class="debug-button" onclick="testPageElements()">æ£€æŸ¥é¡µé¢å…ƒç´ </button>
                    <button class="debug-button" onclick="testAgentMode()">æµ‹è¯•Agentæ¨¡å¼</button>
                    <button class="debug-button" onclick="testSSEConnection()">æµ‹è¯•SSEè¿æ¥</button>
                    <button class="debug-button" onclick="simulatePlanEvent()">æ¨¡æ‹ŸPlanäº‹ä»¶</button>
                    <button class="debug-button" onclick="clearDebugLog()">æ¸…ç©ºæ—¥å¿—</button>
                </div>
            </div>

            <!-- è°ƒè¯•æ—¥å¿— -->
            <div class="debug-section">
                <h3>ğŸ“‹ è°ƒè¯•æ—¥å¿—</h3>
                <div class="debug-log" id="debugLog">
                    ç‚¹å‡»è°ƒè¯•æŒ‰é’®å¼€å§‹è¯Šæ–­...
                </div>
            </div>

            <!-- é¡µé¢é¢„è§ˆ -->
            <div class="debug-section">
                <h3>ğŸ‘€ é¡µé¢é¢„è§ˆ</h3>
                <div class="preview-container">
                    <div class="preview-header">
                        ä»»åŠ¡æ‰§è¡Œé¡µé¢é¢„è§ˆ
                    </div>
                    <div class="preview-content" id="previewContent">
                        <div id="mainPage" style="display: block;">
                            <h3>ä¸»é¡µé¢</h3>
                            <p>è¿™æ˜¯ä¸»é¡µé¢å†…å®¹</p>
                        </div>
                        <div id="taskPage" style="display: none;">
                            <h3>ä»»åŠ¡é¡µé¢</h3>
                            <div id="taskChatContainer">
                                <p>ä»»åŠ¡èŠå¤©å®¹å™¨</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/manus-main.js"></script>
    <script>
        let debugLog = [];

        // æ·»åŠ è°ƒè¯•æ—¥å¿—
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const statusIcon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            debugLog.push(`[${timestamp}] ${statusIcon} ${message}`);
            document.getElementById('debugLog').textContent = debugLog.join('\n');
            document.getElementById('debugLog').scrollTop = document.getElementById('debugLog').scrollHeight;
        }

        // æ£€æŸ¥é¡µé¢å…ƒç´ 
        function testPageElements() {
            addDebugLog('å¼€å§‹æ£€æŸ¥é¡µé¢å…ƒç´ ...');

            // æ£€æŸ¥ä¸»é¡µé¢å…ƒç´ 
            const mainPage = document.getElementById('mainPage');
            addDebugLog(`mainPageå…ƒç´ : ${mainPage ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, mainPage ? 'success' : 'error');

            // æ£€æŸ¥ä»»åŠ¡é¡µé¢å…ƒç´ 
            const taskPage = document.getElementById('taskPage');
            addDebugLog(`taskPageå…ƒç´ : ${taskPage ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, taskPage ? 'success' : 'error');

            // æ£€æŸ¥èŠå¤©å®¹å™¨å…ƒç´ 
            const taskChatContainer = document.getElementById('taskChatContainer');
            addDebugLog(`taskChatContainerå…ƒç´ : ${taskChatContainer ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`, taskChatContainer ? 'success' : 'error');

            // æ£€æŸ¥å…¨å±€å˜é‡
            addDebugLog(`currentManusMessage: ${window.currentManusMessage || 'null'}`);
            addDebugLog(`currentMode: ${window.currentMode || 'undefined'}`);
            addDebugLog(`currentTaskId: ${window.currentTaskId || 'null'}`);
            addDebugLog(`currentFlowId: ${window.currentFlowId || 'null'}`);
        }

        // æµ‹è¯•Agentæ¨¡å¼
        function testAgentMode() {
            addDebugLog('å¼€å§‹æµ‹è¯•Agentæ¨¡å¼...');

            // è®¾ç½®å½“å‰æ¨¡å¼
            window.currentMode = 'agent';
            addDebugLog('è®¾ç½®currentModeä¸ºagent');

            // æ¨¡æ‹Ÿæ˜¾ç¤ºä»»åŠ¡é¡µé¢
            addDebugLog('è°ƒç”¨showTaskPage...');
            if (typeof showTaskPage === 'function') {
                showTaskPage('æµ‹è¯•ä»»åŠ¡', 'agent', 'test-task-123', 'flow');
                addDebugLog('showTaskPageè°ƒç”¨å®Œæˆ');
            } else {
                addDebugLog('showTaskPageå‡½æ•°ä¸å­˜åœ¨ï¼', 'error');
            }

            // æ£€æŸ¥ä»»åŠ¡é¡µé¢æ˜¯å¦æ˜¾ç¤º
            const taskPage = document.getElementById('taskPage');
            const isVisible = taskPage && taskPage.style.display !== 'none';
            addDebugLog(`ä»»åŠ¡é¡µé¢æ˜¯å¦å¯è§: ${isVisible}`, isVisible ? 'success' : 'error');
        }

        // æµ‹è¯•SSEè¿æ¥
        function testSSEConnection() {
            addDebugLog('å¼€å§‹æµ‹è¯•SSEè¿æ¥...');

            // æ£€æŸ¥APIå®¢æˆ·ç«¯
            if (typeof apiClient === 'undefined') {
                addDebugLog('apiClientæœªå®šä¹‰ï¼', 'error');
                return;
            }

            addDebugLog('apiClientå­˜åœ¨');

            // æ£€æŸ¥connectToEventsæ–¹æ³•
            if (typeof apiClient.connectToEvents === 'function') {
                addDebugLog('connectToEventsæ–¹æ³•å­˜åœ¨');
            } else {
                addDebugLog('connectToEventsæ–¹æ³•ä¸å­˜åœ¨ï¼', 'error');
            }

            // æ£€æŸ¥handleTaskEventå‡½æ•°
            if (typeof handleTaskEvent === 'function') {
                addDebugLog('handleTaskEventå‡½æ•°å­˜åœ¨');
            } else {
                addDebugLog('handleTaskEventå‡½æ•°ä¸å­˜åœ¨ï¼', 'error');
            }
        }

        // æ¨¡æ‹ŸPlanäº‹ä»¶
        function simulatePlanEvent() {
            addDebugLog('å¼€å§‹æ¨¡æ‹ŸPlanäº‹ä»¶...');

            const planEvent = {
                type: 'plan',
                result: 'æˆ‘å°†åˆ†æé”€å”®æ•°æ®å¹¶ç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šã€‚é¦–å…ˆæ”¶é›†æ•°æ®ï¼Œç„¶åè¿›è¡Œç»Ÿè®¡åˆ†æï¼Œæœ€åç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ã€‚'
            };

            addDebugLog('Planäº‹ä»¶æ•°æ®: ' + JSON.stringify(planEvent));

            if (typeof handleTaskEvent === 'function') {
                addDebugLog('è°ƒç”¨handleTaskEvent...');
                handleTaskEvent(planEvent);
                addDebugLog('handleTaskEventè°ƒç”¨å®Œæˆ');
            } else {
                addDebugLog('handleTaskEventå‡½æ•°ä¸å­˜åœ¨ï¼', 'error');
            }
        }

        // æ¸…ç©ºè°ƒè¯•æ—¥å¿—
        function clearDebugLog() {
            debugLog = [];
            document.getElementById('debugLog').textContent = 'æ—¥å¿—å·²æ¸…ç©º...';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            addDebugLog('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            addDebugLog('å¼€å§‹è‡ªåŠ¨æ£€æŸ¥é¡µé¢å…ƒç´ ...');
            testPageElements();
        });
    </script>
</body>

</html>
